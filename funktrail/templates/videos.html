<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>FunkTrail — Video</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- Icona hamburger per smartphone -->
<div class="mobile-menu-icon" onclick="toggleMenu()">☰</div>

<!-- Menu mobile popup ridotto -->
<nav id="mobileMenu" class="mobile-menu">
  <a href="{{ url_for('index') }}">Home</a>
  <a href="{{ url_for('photos_page') }}">Photo</a>
  <a href="{{ url_for('videos_page') }}">Video</a>
  <a href="{{ url_for('biografia_page') }}">Biography</a>
  <a href="{{ url_for('concerti_page') }}">Events</a>
  <a href="{{ url_for('shop_page') }}">Shop</a>
  <a href="{{ url_for('contact_page') }}">Contacts</a>
</nav>

<!-- Parte superiore fissa -->
<div class="top-fixed">
  <nav class="desktop-menu">
    <a href="{{ url_for('index') }}">Home</a>
    <a href="{{ url_for('photos_page') }}">Photo</a>
    <a href="{{ url_for('videos_page') }}">Video</a>
    <a href="{{ url_for('biografia_page') }}">Biography</a>
    <a href="{{ url_for('concerti_page') }}">Events</a>
    <a href="{{ url_for('shop_page') }}">Shop</a>
    <a href="{{ url_for('contact_page') }}">Contacts</a>
  </nav>

  <header class="subpage-top">
    <h1>FUNKTRAIL</h1>
    <p class="subtitle">Video Gallery</p>
  </header>
</div>

<div class="header-space"></div>

<main class="scroll-wrapper">
  <div class="scroll-area container">
    <div class="video-grid">

      {% for v in videos %}
        <!-- VIDEO LOCALE MP4 -->
        {% if v.type == "local" %}
        <div class="video-card" data-type="local" data-src="{{ v.video }}">
          <video class="video-thumbnail" preload="metadata">
            <source src="{{ v.video }}#t=0.5" type="video/mp4">
          </video>
          <p class="video-filename">{{ v.name }}</p>
        </div>

        <!-- VIDEO YOUTUBE -->
        {% elif v.type == "youtube" %}
        <div class="video-card" data-type="youtube" data-id="{{ v.id }}">
          <img class="youtube-thumb" 
               src="https://img.youtube.com/vi/{{ v.id }}/hqdefault.jpg" 
               alt="{{ v.name }}">
          <div class="youtube-play-icon">▶</div>
          <p class="video-filename">{{ v.name }}</p>
        </div>
        {% endif %}
      {% endfor %}

    </div>
  </div>

  <!-- Popup fullscreen -->
  <div class="overlay" id="overlay">
    <span class="close-btn" id="close-overlay">&times;</span>

    <!-- Container per video/iframe -->
    <div id="popup-container" style="position:relative;"></div>

    <!-- ✅ Overlay per attivare audio (solo per YouTube) -->
    <div id="unmute-overlay-videos"
         onclick="unmuteVideoGallery()"
         style="
           display:none;
           position:fixed;
           top:0; left:0;
           width:100vw; height:100vh;
           background:rgba(0,0,0,0.25);
           color:#fff;
           font-size:2em;
           display:flex;
           justify-content:center;
           align-items:center;
           text-shadow:0 0 10px #000;
           z-index:5001;
           cursor:pointer;">
      ▶ Tocca per attivare audio
    </div>
  </div>

  <!-- YouTube API (UNA SOLA VOLTA) -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let videoPopupPlayer = null;

    function onYouTubeIframeAPIReady() {
      console.log("API YouTube pronta per Galleria Video");
    }
  </script>

  <!-- Script per popup video -->
  <script>
    const overlay   = document.getElementById('overlay');
    const container = document.getElementById('popup-container');
    const closeBtn  = document.getElementById('close-overlay');
    const unmuteUI  = document.getElementById('unmute-overlay-videos');

    // Cattura tutte le card video
    document.querySelectorAll('.video-card').forEach(card => {
      card.addEventListener('click', () => {
        overlay.style.display = 'flex';
        container.innerHTML = "";

        const type = card.dataset.type;

        if (type === "local") {
          // === VIDEO LOCALE (MP4): nessun overlay audio ===
          const src = card.dataset.src;

          // Se c'era un player YT aperto, lo chiudo/pulisco
          if (videoPopupPlayer) {
            try { videoPopupPlayer.stopVideo(); videoPopupPlayer.destroy(); } catch(e){}
            videoPopupPlayer = null;
          }
          unmuteUI.style.display = "none";

          container.innerHTML = `
            <video src="${src}" controls autoplay 
                   style="max-width:100%; max-height:100%; border-radius:10px;">
            </video>`;
        } else if (type === "youtube") {
          // === VIDEO YOUTUBE: parte muto + overlay "attiva audio" ===
          const id = card.dataset.id;

          container.innerHTML = `
            <iframe 
              id="youtube-player-popup"
              src="https://www.youtube.com/embed/${id}?autoplay=1&mute=1&playsinline=1&enablejsapi=1"
              frameborder="0"
              allow="autoplay; encrypted-media; picture-in-picture"
              allowfullscreen
              style="width:100%; height:100%; border-radius:10px;">
            </iframe>`;

          unmuteUI.style.display = "flex";
        }
      });
    });

    // Chiusura popup
    closeBtn.addEventListener('click', () => {
      overlay.style.display = 'none';
      container.innerHTML = "";
      unmuteUI.style.display = "none";

      // Ferma e distruggi player YouTube se esiste
      if (videoPopupPlayer) {
        try { videoPopupPlayer.stopVideo(); videoPopupPlayer.destroy(); } catch(e){}
        videoPopupPlayer = null;
      }
    });

    // Funzione per togliere il mute su YouTube (identico alla home)
    function unmuteVideoGallery() {
      const iframeId = "youtube-player-popup";

      // Se il player esiste già
      if (videoPopupPlayer && typeof videoPopupPlayer.unMute === "function") {
        try {
          videoPopupPlayer.mute();
          videoPopupPlayer.unMute();
          videoPopupPlayer.playVideo();
        } catch(e) { console.warn(e); }
        unmuteUI.style.display = "none";
        return;
      }

      // Altrimenti crealo sull'iframe esistente
      try {
        videoPopupPlayer = new YT.Player(iframeId, {
          events: {
            onReady: function (event) {
              event.target.mute();      // passaggio richiesto da YouTube
              event.target.unMute();    // sblocca audio
              event.target.playVideo(); // continua senza riavvio
              unmuteUI.style.display = "none";
            }
          }
        });
      } catch (e) {
        console.error("YT.Player non disponibile ancora:", e);
      }
    }
  </script>

</main>

<footer class="site-footer">
  <small>© 2025 FunkTrail.com — Tutti i diritti riservati</small>
</footer>

<!-- Script menu mobile -->
<script>
  function toggleMenu() {
    const menu = document.getElementById("mobileMenu");
    if (menu) menu.classList.toggle("active");
  }
  document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll('.mobile-menu a').forEach(link => {
      link.addEventListener('click', () => {
        const menu = document.getElementById("mobileMenu");
        if (menu) menu.classList.remove("active");
      });
    });
  });
</script>



</body>
</html>
